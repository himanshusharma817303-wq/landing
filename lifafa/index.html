<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Opening...</title>

<style>
body{
    margin:0;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#0B0B10;
    color:white;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
}
</style>
</head>

<body>
<p>Opening Rozsetu...</p>

<script>

/* =========================
   CONFIG
========================= */

// ðŸ‘‰ App not installed fallback
const fallbackUrl = "https://rozsetu.com";

/* =========================
   PARAMS
========================= */

const params = new URLSearchParams(location.search);
const e = params.get("e");
const t = params.get("t");

if (!e || !t) {
    location.replace(fallbackUrl);
}

/* =========================
   DEEP LINK
========================= */

const deepLink = `rozsetu://lifafa?e=${e}&t=${t}`;

/* =========================
   INSTANT OPEN METHOD
========================= */

let opened = false;

// detect app open
document.addEventListener("visibilitychange", () => {
    if (document.hidden) opened = true;
});

/*
   MAGIC PART:
   iframe method = fastest + most reliable
*/
const iframe = document.createElement("iframe");
iframe.style.display = "none";
iframe.src = deepLink;
document.body.appendChild(iframe);

/* backup open (some browsers block iframe) */
setTimeout(() => {
    location.href = deepLink;
}, 100);

/* =========================
   FALLBACK
========================= */

setTimeout(() => {
    if (!opened) {
        location.replace(fallbackUrl);
    }
}, 1800);

</script>

</body>
</html>
